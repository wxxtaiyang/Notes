## 线程池

把一个或多个线程通过统一的方式进行调度和重复使用的技术，避免了因为线程过多而带来使用上的开销。

**优点**：降低资源消耗。通过复用已创建的线程减低线程的创建和销毁。

​			提高影响速度。任务到达时可立即执行无需等待线程创建

​			提高线程的可管理性。

**工作原理**：

​	当线程池中有任务需要执行时，线程池会判断如果线程数量没有超过核心数量就会新建线程池进行任务执行，如果线程池中的线程数量已经超过核心线程数，这时候任务就会被放入任务队列中排队等待执行；如果任务队列超过最大队列数，并且线程池没有达到最大线程数，就会新建线程来执行任务；如果超过了最大线程数，就会执行拒绝执行策略。

**线程池的使用**：

主要使用**ThreadPoolExecutor**类。构造方法有四个。

参数解析：

​				corePoolSize：核心线程数

​				maximumPoolSize：最大线程数（包扣核心线程数）

​				keepAliveTime：线程池限制超时时间。

​				unit：用来标识keepAliveTime的时间单位

​				workQueue：线程池中的任务队列，使用execute或submit提交的任务都会存储在此队列中。

​				threadFactory：为线程池提供创建新线程的线程工厂

​				rejectedExecutionHandler：线程池任务队列超过最大值之后的拒绝策略。默认四种拒绝策略

​							DiscardPolicy：丢弃任务，不抛出异常

​							DiscardOldestPolicy：丢弃队列中等待最久的任务

​							AbortPolicy：丢弃任务抛出异常（默认）

​							CallerRunsPolicy：由主线程负责调用，绕过线程池直接执行

常用的方法：

​			**execute**：执行线程，无返回值

​			**submit**：执行线程，有返回值

​			**shutdown**：终止线程池，会等待池中线程结束

​			**shutdownNow**：终止线程池，马上执行停止池中所有线程

​			**isShutdown**：判断线程是否终止

​			**getActiveCount**：正在运行的线程数

​			**getCorePoolSize**：获取核心线程数

​			**getMaximumPoolSize**：获取最大线程数

​			**getQueue**：获取线程池中的任务队列

​			**allowCoreThreadTimeOut(boolean)**：设置空闲时是否回收核心线程

线程池使用(阻塞)**队列**是为了若线程无限制创建，可能导致内存过多而产生OOM（内存溢出异常），导致cpu过度切换。创建线程池的消耗较高。

阻塞队列可以保证任务队列中没有任务时阻塞获取任务的线程，使得线程进入wait状态，释放CPU资源。当队列中有任务时才唤醒对应线程从队列中取出消息进行执行。使用线程不至于一直占用CPU资源。



